---
output:
  github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	echo=FALSE,
	dpi=300
	)
```

# Peabody Invertebrate Zoology Collections Statistics

This document describes a variety of statistics about the [Peabody Invertebrate Zoology Collections](http://peabody.yale.edu/collections/invertebrate-zoology).

The data were obtained from Daniel Drew on January 8, 2018.

```{r}
library( tidyverse )
library( magrittr )
library( knitr )
library( plotly )


D = read_tsv( "IZReport_20180108.tsv" )

nrow(D)
names(D)





```

```{r asis=TRUE }

summary_stats = data.frame(Description=character(), N=numeric())
summary_stats %<>% rbind(list( "All Records", nrow(D) ), stringsAsFactors=FALSE )
summary_stats %<>% rbind(list( "Lat and Lon", sum( 
	!is.na(D$`Latitude (dec)`) & !is.na(D$`Longitude (dec)`), 
	stringsAsFactors=FALSE
	) ) )

names(summary_stats) = c("Description", "N")

kable(summary_stats)

```


```{r asis=TRUE}
phylum_list = table(D$Phylum)
phylum_frame = data.frame(Taxon=names(phylum_list), N=phylum_list)
kable( phylum_frame )
```


```{r}
ggplot(D) + 
	geom_freqpoly(aes(x=`Collecting Year`, y=..count..)) +
	xlim(1800, 2017)
```
```{r}

collectors = c(table(D$`Collector/Expedition`))
collectors = collectors[order(collectors, decreasing = TRUE)]

collectors_frame = data.frame(Name=names(collectors), N=collectors, stringsAsFactors = FALSE)
rownames(collectors_frame) = NULL
kable( collectors_frame[1:100,] )
```


## Locations

```{r}

D_ll = D[ (!is.na(D$`Latitude (dec)`) & !is.na(D$`Longitude (dec)`) ), ]


mapWorld <- borders("world", colour="gray50", fill="gray50") # create a layer of borders

mp = 
	ggplot( D_ll ) +   
	mapWorld + 
	geom_point(
		aes(x=`Longitude (dec)`, y=`Latitude (dec)`, col=`Collecting Year`, label1=`Catalog Number` ), alpha = 0.2, size=1
		) +
	scale_color_gradient(low="blue", high="red")

mp
# ggplotly(mp)


```

## Arianna queries

### Most prolific collectors

Most collections are from the US Fish Commission cruises, so I'll separate these out.

```{r}

fish_string = "^U.S. Fish Comm"

collectors_focal = 
	collectors_frame %>%
	filter( str_detect(Name, fish_string) )

D_ll %>%
	filter( `Collector/Expedition` %in% collectors_focal$Name[1:10] ) %>%
	ggplot( ) +  
		mapWorld +
		geom_point(aes(x=`Longitude (dec)`, y=`Latitude (dec)`, col=`Collector/Expedition` ), alpha = 0.2, size=1) +
	  guides(colour = guide_legend(override.aes = list(alpha = 1)))

```

Here are the non US Fish Commission cruises collectors.


```{r}

collectors_focal = 
	collectors_frame %>%
	filter( ! str_detect(Name, fish_string) )

map_not_fish =
D_ll %>%
	filter( `Collector/Expedition` %in% collectors_focal$Name[1:10] ) %>%
	ggplot( ) +  
		mapWorld +
		geom_point(aes(x=`Longitude (dec)`, y=`Latitude (dec)`, colour=str_wrap (`Collector/Expedition`,20) ), alpha = 0.2, size=1) +
  labs(colour="Collecter/Expedition") +
	  guides(colour = guide_legend(override.aes = list(alpha = 1)))

map_not_fish

```

## Lazo-Wasem_string

Eric has been a very prolific collector, however his name as a collector varies within the collection due to differnet collection events/other co-collectors 

Below I have seperated these out.

```{r}

LazoWasem_string = "^Lazo-Wasem"
 
collectors_focal = 
    collectors_frame %>%
    filter( str_detect(Name, LazoWasem_string) )

D_ll %>%
  filter( `Collector/Expedition` %in% collectors_focal$Name[1:18] ) %>%
  ggplot( ) +  
  mapWorld +
  geom_point(aes(x=`Longitude (dec)`, y=`Latitude (dec)`, colour=str_wrap (`Collector/Expedition`,40) ), alpha = 0.2, size=1) +
  labs(colour="Collecter/Expedition") +
  guides(colour = guide_legend(override.aes = list(alpha = 1)))
  

```




## Sub regions

```{r}


mapPacific <- borders("world", colour="gray50", fill="gray50") # create a layer of borders

mp = 
	ggplot( D_ll ) +   
	mapPacific + 
	geom_point(
		aes(x=`Longitude (dec)`, y=`Latitude (dec)`, col=`Collecting Year`, label1=`Catalog Number` ), alpha = 0.2, size=1
		) +
	scale_color_gradient(low="blue", high="red")

mp
# ggplotly(mp)


```



## U.S. Exploring Expedition 1838-1842

The U.S exploring Expeditions were of historical importance! What specimens in the Peabody IZ Division Collections are from this and where in Pacific are they from?

It turns out that most of these specimens do not have lat and long or precise locality, perhaps to gain this data cross reference with orignial ship logs? Or use the Nearest named place as the locality? 

- Next objective create a map using the nearest named place as the locality

```{r}
D %>% filter(`Collector/Expedition`=="U.S. Exploring Expedition 1838-1842")

```


